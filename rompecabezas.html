<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Rompecabezas de nosotras 💕</title>
<style>
  body {
    background: #fff0f6;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    margin: 0;
  }
  h1 {
    color: #d6336c;
    margin-bottom: 20px;
  }
  #puzzle {
    position: relative;
    width: 400px;
    height: 400px;
    border: 3px solid #d6336c;
    border-radius: 15px;
    user-select: none;
    background: #fff0f6;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    gap: 2px;
  }
  .piece {
  width: 100%;
  height: 100%;
  background-image: url('https://i.postimg.cc/0jhbCy5d/543066431-31189411970674254-82676996826556259-n.jpg');
  background-size: 400px 400px;
  cursor: grab;
  border-radius: 8px;
  box-shadow: 0 0 5px rgba(214,51,108,0.6);
  }

  #resetBtn, #nextBtn {
    margin-top: 20px;
    background: #d6336c;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 25px;
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    transition: background 0.3s ease;
  }
  #resetBtn:hover, #nextBtn:hover {
    background: #a02945;
  }

  #message {
    margin-top: 15px;
    font-size: 1.4em;
    color: #d6336c;
    font-weight: bold;
    height: 2em;
  }
</style>
</head>
<body>

<h1>Arma nuestro rompecabezas 💕</h1>

<div id="puzzle"></div>
<button id="resetBtn">Reiniciar</button>
<button id="nextBtn" style="display:none;">Siguiente</button>
<div id="message"></div>

<script>
  const puzzle = document.getElementById('puzzle');
  const resetBtn = document.getElementById('resetBtn');
  const nextBtn = document.getElementById('nextBtn');
  const message = document.getElementById('message');

  const rows = 4;
  const cols = 4;
  const totalPieces = rows * cols;

  let pieces = [];

  function createPuzzle() {
    pieces = [];
    puzzle.innerHTML = '';
    message.textContent = '';
    nextBtn.style.display = 'none'; // ocultamos el botón siguiente al reiniciar
    for(let i = 0; i < totalPieces; i++) {
      const piece = document.createElement('div');
      piece.classList.add('piece');
      const x = (i % cols) * 100;
      const y = Math.floor(i / cols) * 100;
      piece.style.backgroundPosition = `-${x}px -${y}px`;
      piece.setAttribute('data-index', i);
      pieces.push(piece);
    }
    shufflePieces();
  }

  function shufflePieces() {
    pieces = pieces.sort(() => Math.random() - 0.5);
    pieces.forEach(piece => puzzle.appendChild(piece));
  }

  let dragged = null;

  puzzle.addEventListener('dragstart', e => {
    if (e.target.classList.contains('piece')) {
      dragged = e.target;
      e.dataTransfer.effectAllowed = "move";
    }
  });

  puzzle.addEventListener('dragover', e => {
    e.preventDefault();
  });

  puzzle.addEventListener('drop', e => {
    e.preventDefault();
    if (e.target.classList.contains('piece') && dragged) {
      const draggedIndex = Array.from(puzzle.children).indexOf(dragged);
      const targetIndex = Array.from(puzzle.children).indexOf(e.target);

      if (draggedIndex === -1 || targetIndex === -1) return;

      puzzle.insertBefore(dragged, e.target);
      if (targetIndex < draggedIndex) {
        puzzle.insertBefore(e.target, puzzle.children[draggedIndex]);
      } else {
        puzzle.insertBefore(e.target, puzzle.children[draggedIndex + 1]);
      }
      checkWin();
    }
  });

  puzzle.addEventListener('mousedown', e => {
    if (e.target.classList.contains('piece')) {
      e.target.setAttribute('draggable', 'true');
    }
  });

  puzzle.addEventListener('mouseup', e => {
    if (e.target.classList.contains('piece')) {
      e.target.removeAttribute('draggable');
    }
  });

  function checkWin() {
    const currentOrder = Array.from(puzzle.children).map(piece => piece.getAttribute('data-index'));
    for(let i = 0; i < totalPieces; i++) {
      if(currentOrder[i] != i) return;
    }
    // Cuando gana, mostrar mensaje y botón siguiente
    message.textContent = 'Perfecto amor, lo lograste ❤️';
    nextBtn.style.display = 'inline-block';
  }

  resetBtn.addEventListener('click', () => {
    createPuzzle();
  });let dragged = null;
  let offsetX, offsetY;
  

  function startDrag(e) {
    if(!e.target.classList.contains('piece')) return;
    e.preventDefault();
    dragged = e.target;
    const rect = dragged.getBoundingClientRect();

    if(e.type === 'touchstart') {
      offsetX = e.touches[0].clientX - rect.left;
      offsetY = e.touches[0].clientY - rect.top;
    } else {
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
    }

    dragged.style.position = 'absolute';
    dragged.style.zIndex = 1000;
  }

  function drag(e) {
    if (!dragged) return;
    e.preventDefault();

    let x, y;
    if(e.type === 'touchmove') {
      x = e.touches[0].clientX - offsetX;
      y = e.touches[0].clientY - offsetY;
    } else {
      x = e.clientX - offsetX;
      y = e.clientY - offsetY;
    }

    dragged.style.left = x + 'px';
    dragged.style.top = y + 'px';
  }

  function endDrag(e) {
    if (!dragged) return;

    // Ajustar posición relativa de la pieza al soltar
    dragged.style.position = 'relative';
    dragged.style.left = '';
    dragged.style.top = '';
    dragged.style.zIndex = '';

    dragged = null;
    checkWin();
  }

  // Eventos para PC
  puzzle.addEventListener('mousedown', startDrag);
  puzzle.addEventListener('mousemove', drag);
  puzzle.addEventListener('mouseup', endDrag);

  // Eventos para móviles
  puzzle.addEventListener('touchstart', startDrag);
  puzzle.addEventListener('touchmove', drag);
  puzzle.addEventListener('touchend', endDrag);

  // ---- FIN ARRASTRE ----

  function checkWin() {
    const currentOrder = Array.from(puzzle.children).map(piece => piece.getAttribute('data-index'));
    for(let i = 0; i < totalPieces; i++) {
      if(currentOrder[i] != i) return;
    }
    // Cuando gana, mostrar mensaje y botón siguiente
    message.textContent = 'Perfecto amor, lo lograste ❤️';
    nextBtn.style.display = 'inline-block';
  }

  resetBtn.addEventListener('click', () => {
    createPuzzle();
  });

  nextBtn.addEventListener('click', () => {
    window.location.href = 'seleccion_corazon.html'; // Cambia esta ruta a donde quieras
  });

  createPuzzle();
</script>

</body>
</html>
